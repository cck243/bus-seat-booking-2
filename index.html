<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BusBooking Admin</title>
  <style>
    body { font-family: Arial, sans-serif; background:#f5f5f5; margin:0; padding:0; }
    .section { max-width:800px; margin:20px auto; padding:20px; background:#fff; border-radius:8px; }
    .hidden { display:none; }
    table { width:100%; border-collapse:collapse; margin-top:15px; }
    th, td { border:1px solid #ddd; padding:8px; }
    th { background:#eee; }
    button { margin:2px; padding:5px 10px; }
  </style>
</head>
<body>

  <!-- Admin Login -->
  <div id="admin-login" class="section">
    <h2>Admin Login</h2>
    <label>Email</label><br>
    <input type="email" id="admin-username"><br><br>
    <label>Password</label><br>
    <input type="password" id="admin-password"><br><br>
    <button onclick="adminLogin()">Login</button>
  </div>

  <!-- Admin Panel -->
  <div id="admin-panel" class="section hidden">
    <h2>Admin Panel</h2>
    <button onclick="logoutAdmin()">Logout</button>

    <h3>Manage Buses</h3>
    <button onclick="addNewBus()">Add New Bus</button>
    <table>
      <thead>
        <tr><th>ID</th><th>Name</th><th>Capacity</th><th>Type</th><th>Actions</th></tr>
      </thead>
      <tbody id="buses-table"></tbody>
    </table>

    <h3>Manage Routes</h3>
    <button onclick="addNewRoute()">Add New Route</button>
    <table>
      <thead>
        <tr><th>ID</th><th>From</th><th>To</th><th>Distance</th><th>Duration</th><th>Actions</th></tr>
      </thead>
      <tbody id="routes-table"></tbody>
    </table>
  </div>

  <!-- Firebase & App Logic -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-app.js";
    import { getAuth, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-auth.js";
    import { getFirestore, collection, addDoc, getDocs, updateDoc, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-firestore.js";

    // ðŸ”‘ Replace with your Firebase config
    const firebaseConfig = {
      apiKey: "YOUR-API-KEY",
      authDomain: "YOUR-PROJECT.firebaseapp.com",
      projectId: "YOUR-PROJECT-ID",
      storageBucket: "YOUR-PROJECT.appspot.com",
      messagingSenderId: "XXXX",
      appId: "XXXX"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // --- Admin Login ---
    window.adminLogin = async function () {
      const email = document.getElementById("admin-username").value;
      const pass = document.getElementById("admin-password").value;
      try {
        await signInWithEmailAndPassword(auth, email, pass);
        document.getElementById("admin-login").classList.add("hidden");
        document.getElementById("admin-panel").classList.remove("hidden");
        loadBuses();
        loadRoutes();
      } catch (e) {
        alert("Login failed: " + e.message);
      }
    };

    // --- Logout ---
    window.logoutAdmin = async function () {
      await signOut(auth);
      document.getElementById("admin-panel").classList.add("hidden");
      document.getElementById("admin-login").classList.remove("hidden");
    };

    // --- Buses CRUD ---
    window.loadBuses = async function () {
      const snap = await getDocs(collection(db, "buses"));
      const tbody = document.getElementById("buses-table");
      tbody.innerHTML = "";
      snap.forEach(d => {
        const bus = d.data();
        tbody.innerHTML += `
          <tr>
            <td>${d.id}</td>
            <td>${bus.name}</td>
            <td>${bus.capacity}</td>
            <td>${bus.type}</td>
            <td>
              <button onclick="editBus('${d.id}')">Edit</button>
              <button onclick="deleteBus('${d.id}')">Delete</button>
            </td>
          </tr>`;
      });
    };

    window.addNewBus = async function () {
      const name = prompt("Bus name?");
      const capacity = prompt("Capacity?");
      const type = prompt("Type (AC/Non-AC)?");
      await addDoc(collection(db, "buses"), { name, capacity, type });
      loadBuses();
    };

    window.editBus = async function (id) {
      const name = prompt("New name?");
      if (name) {
        await updateDoc(doc(db, "buses", id), { name });
        loadBuses();
      }
    };

    window.deleteBus = async function (id) {
      await deleteDoc(doc(db, "buses", id));
      loadBuses();
    };

    // --- Routes CRUD ---
    window.loadRoutes = async function () {
      const snap = await getDocs(collection(db, "routes"));
      const tbody = document.getElementById("routes-table");
      tbody.innerHTML = "";
      snap.forEach(d => {
        const r = d.data();
        tbody.innerHTML += `
          <tr>
            <td>${d.id}</td>
            <td>${r.from}</td>
            <td>${r.to}</td>
            <td>${r.distance}</td>
            <td>${r.duration}</td>
            <td>
              <button onclick="editRoute('${d.id}')">Edit</button>
              <button onclick="deleteRoute('${d.id}')">Delete</button>
            </td>
          </tr>`;
      });
    };

    window.addNewRoute = async function () {
      const from = prompt("From?");
      const to = prompt("To?");
      const distance = prompt("Distance?");
      const duration = prompt("Duration?");
      await addDoc(collection(db, "routes"), { from, to, distance, duration });
      loadRoutes();
    };

    window.editRoute = async function (id) {
      const duration = prompt("New duration?");
      if (duration) {
        await updateDoc(doc(db, "routes", id), { duration });
        loadRoutes();
      }
    };

    window.deleteRoute = async function (id) {
      await deleteDoc(doc(db, "routes", id));
      loadRoutes();
    };

  </script>
</body>
</html>
