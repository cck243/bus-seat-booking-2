<script>
  // ---------------------------
  // Admin Security
  // ---------------------------
  let isAdminLoggedIn = false;

  function showAdminPanel() {
    if (isAdminLoggedIn) {
      document.getElementById("booking-section").classList.add("hidden");
      document.getElementById("my-bookings-section").classList.add("hidden");
      document.getElementById("admin-panel").classList.remove("hidden");
      document.getElementById("admin-login").classList.add("hidden");
      loadAdminBookings();
      updateAdminStats();
      loadBuses();
      loadRoutes();
    } else {
      document.getElementById("booking-section").classList.add("hidden");
      document.getElementById("my-bookings-section").classList.add("hidden");
      document.getElementById("admin-panel").classList.add("hidden");
      document.getElementById("admin-login").classList.remove("hidden");
    }
  }

  function adminLogin() {
    const username = document.getElementById("admin-username").value.trim();
    const password = document.getElementById("admin-password").value.trim();
    if (username === "admin" && password === "admin123") {
      isAdminLoggedIn = true;
      localStorage.setItem("adminLoggedIn", "true");
      showAdminPanel();
    } else {
      alert("Invalid admin credentials");
    }
  }

  // ---------------------------
  // Data storage
  // ---------------------------
  let bookings = JSON.parse(localStorage.getItem("bookings")) || [];
  let busesData = JSON.parse(localStorage.getItem("busesData")) || [
    { id: "BUS001", name: "Express Bus 1", capacity: 40, type: "AC" },
    { id: "BUS002", name: "Luxury Bus 2", capacity: 35, type: "Non-AC" }
  ];
  let routesData = JSON.parse(localStorage.getItem("routesData")) || [
    { id: "RT001", from: "New York", to: "Boston", distance: "215 miles", duration: "4 hours" },
    { id: "RT002", from: "Los Angeles", to: "San Francisco", distance: "380 miles", duration: "6 hours" }
  ];

  // ---------------------------
  // Manage Buses
  // ---------------------------
  function loadBuses() {
    const tbody = document.querySelector("#buses-tab table tbody");
    tbody.innerHTML = "";
    busesData.forEach(bus => {
      tbody.innerHTML += `
        <tr>
          <td>${bus.id}</td>
          <td>${bus.name}</td>
          <td>${bus.capacity}</td>
          <td>${bus.type}</td>
          <td>
            <button onclick="editBus('${bus.id}')" class="btn-secondary">Edit</button>
            <button onclick="deleteBus('${bus.id}')" class="btn-danger">Delete</button>
          </td>
        </tr>`;
    });
  }

  function addNewBus() {
    const id = "BUS" + String(Date.now()).slice(-4);
    const name = prompt("Enter bus name:");
    const capacity = prompt("Enter bus capacity:");
    const type = prompt("Enter bus type (AC/Non-AC):");
    if (name && capacity && type) {
      busesData.push({ id, name, capacity, type });
      localStorage.setItem("busesData", JSON.stringify(busesData));
      loadBuses();
    }
  }

  function editBus(id) {
    const bus = busesData.find(b => b.id === id);
    if (!bus) return;
    const name = prompt("Edit bus name:", bus.name);
    const capacity = prompt("Edit capacity:", bus.capacity);
    const type = prompt("Edit type:", bus.type);
    if (name && capacity && type) {
      bus.name = name;
      bus.capacity = capacity;
      bus.type = type;
      localStorage.setItem("busesData", JSON.stringify(busesData));
      loadBuses();
    }
  }

  function deleteBus(id) {
    if (confirm("Delete this bus?")) {
      busesData = busesData.filter(b => b.id !== id);
      localStorage.setItem("busesData", JSON.stringify(busesData));
      loadBuses();
    }
  }

  // ---------------------------
  // Manage Routes
  // ---------------------------
  function loadRoutes() {
    const tbody = document.querySelector("#routes-tab table tbody");
    tbody.innerHTML = "";
    routesData.forEach(r => {
      tbody.innerHTML += `
        <tr>
          <td>${r.id}</td>
          <td>${r.from}</td>
          <td>${r.to}</td>
          <td>${r.distance}</td>
          <td>${r.duration}</td>
          <td>
            <button onclick="editRoute('${r.id}')" class="btn-secondary">Edit</button>
            <button onclick="deleteRoute('${r.id}')" class="btn-danger">Delete</button>
          </td>
        </tr>`;
    });
  }

  function addNewRoute() {
    const id = "RT" + String(Date.now()).slice(-4);
    const from = prompt("From:");
    const to = prompt("To:");
    const distance = prompt("Distance:");
    const duration = prompt("Duration:");
    if (from && to && distance && duration) {
      routesData.push({ id, from, to, distance, duration });
      localStorage.setItem("routesData", JSON.stringify(routesData));
      loadRoutes();
    }
  }

  function editRoute(id) {
    const route = routesData.find(r => r.id === id);
    if (!route) return;
    const from = prompt("Edit From:", route.from);
    const to = prompt("Edit To:", route.to);
    const distance = prompt("Edit Distance:", route.distance);
    const duration = prompt("Edit Duration:", route.duration);
    if (from && to && distance && duration) {
      route.from = from;
      route.to = to;
      route.distance = distance;
      route.duration = duration;
      localStorage.setItem("routesData", JSON.stringify(routesData));
      loadRoutes();
    }
  }

  function deleteRoute(id) {
    if (confirm("Delete this route?")) {
      routesData = routesData.filter(r => r.id !== id);
      localStorage.setItem("routesData", JSON.stringify(routesData));
      loadRoutes();
    }
  }

  // ---------------------------
  // Bookings / Stats (unchanged from your version)
  // ---------------------------
  function loadAdminBookings() { /* keep your existing code */ }
  function updateAdminStats() { /* keep your existing code */ }

  // ---------------------------
  // Init
  // ---------------------------
  window.onload = function () {
    const stored = localStorage.getItem("adminLoggedIn");
    isAdminLoggedIn = stored === "true";
    document.getElementById("booking-section").classList.remove("hidden");
  };
</script>
